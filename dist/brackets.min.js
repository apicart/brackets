/** 
 * brackets.js v1.0.0-alpha1 
 * (c) 2018-2019 Vladimír Macháček
 *  Released under the MIT License.
 */
!function(e){"function"==typeof define&&define.amd?define(e):e()}(function(){"use strict";var Brackets={devMode:!1},eventHandlersAttributeName="b-on",nonInitializedElementAttributeName="b-init",selectorAttributeName="data-b-instance",templateLiteralsEnabled=function(){try{return eval("`x`"),!0}catch(e){return!1}}(),templateLiteral=templateLiteralsEnabled?"`":"'";function cloneObject(t){var n={};return Object.keys(t).forEach(function(e){n[e]=t&&typeof t===Object(t)?cloneObject(t[e]):t[e]}),n}function each(e,t){var n,r,a,i,s;if(Array.isArray(e)){if(!(r=e.length))return;for(n=0;n<r&&!1!==t(n,e[n]);n++);}else{if(i=(a=Object.keys(e)).length,!a.length)return;for(n=0;n<i&&!1!==t(s=a[n],e[s]);n++);}}function generateHash(e){return e=e||10,e+=2,Math.random().toString(36).substring(2,e)}var macros={breakif:"if (#0) break;",continueif:"if (#0) continue;",component:function(e){var t=e[0].split(","),n=t[0];return t.shift(),"_template += _runtime.components.renderToString.call(_runtime, '"+n+"', "+("{"+t.join(",")+"}")+");"},dump:"console.log(#0);",else:"} else {",elseif:"} else if (#0) {",for:"for (var #0) {","/for":"}",if:"if (#0) {","/if":"}",js:"#0;",var:"var #0;",while:"while (#0) {","/while":"}"},macrosRegularExpression;function addMacro(e,t){if(e in macros)throw new Error('Brackets: Macro "'+e+'" is already defined.');return macros[e]=t,generateMacrosRegularExpression(),Brackets}function getMacros(){return macros}function generateMacrosRegularExpression(){macrosRegularExpression=new RegExp("{{(?:(?:("+Object.keys(macros).join("|").replace("/","/")+")(?: (.*?))?)|(?:(\\$.*?)))}}")}generateMacrosRegularExpression();var tokenReplacement="}}{{",textRegularExpression=/{{((?:.|\n)*?)}}/;function tokenizeTemplate(e){var t,n,r,a=[],i=[];if(e){for(;t=macrosRegularExpression.exec(e);)n=[],r=t[0],t.shift(),each(t,function(e,t){isNaN(parseInt(e))||void 0!==t&&n.push(t)}),a.push(n),e=e.replace(r,tokenReplacement);for(e="{{"+e+"}}";t=textRegularExpression.exec(e);)i.push(t[1]),e=e.replace(t[0],"")}return{macros:a,text:i}}function processVariable(e){var n,r,a=!0,i=[],t=e[0].split("|"),s=t[0].replace("$","");return t.shift(),t.length&&each(t,function(e,t){n=t.split(":"),"noescape"!==(r=n[0]||null)?((i="string"==typeof n[1]?n[1].split(","):[]).unshift(s),s="_templateAdd("+i.join(",")+", '"+r+"')"):a=!1}),"_template += _templateAdd("+s+", "+a+");"}function processMacro(e){var n,t=e[0],r=getMacros();return e.shift(),"string"==typeof r[t]?(n=r[t],each(e,function(e,t){n=n.replace(new RegExp("#"+e),t)})):n=r[t](e),n}var variableMatchRegularExpression=/^\$/;function compileTemplate(n,e){var r,a,i="var _template = '';"+_templateAdd.toString();return each(n.text,function(e,t){if(i+="_template += _templateAdd("+templateLiteral+t+templateLiteral+");",e in n.macros)if(r=n.macros[e],(a=r[0]).match(variableMatchRegularExpression))i+=processVariable(r);else{if(!(a in getMacros()))throw'Unknown token: "'+a+'"';i+=processMacro(r)}}),i+="return _template;",new Function(e.join(","),i)}function _templateAdd(e,t){return void 0===e?"":(t=!0===(t=!1===t?null:t)?"escape":t)?_runtime.getFilter(t)(e):e}var filters={};function addFilter(e,t){if(getFilter(e,!1))throw new Error('Brackets: Filter "'+e+'" is already defined.');return filters[e]=t,Brackets}function getFilter(e,t){if(!1!==t&&!(e in filters))throw new Error('Brackets: Filter "'+e+'" not found.');return filters[e]||null}function getFilters(){return filters}function bindPropertyDescriptors(n){each(n.data,function(t,e){t in n._data||(n._data[t]=e,Object.defineProperty(n.data,t,{get:function(){return n._data[t]},set:function(e){n._data[t]=e,n._status===renderingInstancesStatuses.rendered&&redrawInstance(n.instanceId)}}))})}addFilter("escape",function(e){var t={'"':"&quot;","&":"&amp;","'":"&#39;","/":"&#x2F;","<":"&lt;","=":"&#x3D;",">":"&gt;","`":"&#x60;"};return String(e).replace(/[&<>"'`=/]/g,function(e){return t[e]})});var renderingInstances={},renderingInstancesStatuses={pending:"pending",processing:"processing",rendered:"rendered"};function getRenderingInstances(n){if(!n)return renderingInstances;var r={};return each(renderingInstances,function(e,t){t._type===n&&(r[e]=t)}),r}function getRenderingInstance(e,t){if(!1!==t&&!(e in renderingInstances))throw new Error('Brackets: Rendering instance "'+e+'" not found.');return renderingInstances[e]}function createRenderingInstanceObject(e,t){var n={afterRender:(e=cloneObject(e)).afterRender||function(){},beforeRender:e.beforeRender||function(){},cacheKey:e.cacheKey||null,data:e.data?cloneObject(e.data):{},methods:e.methods||{},onStatusChange:e.onStatusChange||function(){},template:e.template,addData:function(e,t){this.data[e]=t,bindPropertyDescriptors(this)},_data:{},_hash:generateHash(),_type:e._type||"view",_parent:null,_status:renderingInstancesStatuses.pending,_setStatus:function(e){this._status=e,this.onStatusChange.call(this,e)},set instanceId(e){this._instanceId=e},get instanceId(){return this._instanceId?this._instanceId+"-"+this._hash:this._hash},get el(){return"["+selectorAttributeName+'="'+this.instanceId+'"]'}};if(n.instanceId=e.instanceId||null,t&&!t.getAttribute(selectorAttributeName)&&t.setAttribute(selectorAttributeName,n.instanceId),!e.template&&t)n.template=t.innerHTML;else if(e.template&&e.template.match(/^#\S+/)){var r=document.querySelector(e.template);r&&(n.template=r.innerHTML)}else if(!e.template&&!t)throw new Error("Brackets: No template or target element provided for rendering.");if(bindPropertyDescriptors(n),getRenderingInstance(n.instanceId,!1))throw new Error('Brackets: Rendering instance "'+n.instanceId+'" is already defined.');return renderingInstances[n.instanceId]=n}var components={register:{},renderToString:renderComponent};function renderComponent(e,t){var n=getComponent(e);t&&each(t,function(e,t){n.data[e]=t}),n._parent=this.parentInstance;var r=renderToString(n),a=[n.instanceId].concat(r.templateRuntime.renderedComponents);return this.renderedComponents=this.renderedComponents.concat(a),r.templateString}function addComponent(e,t){if(getComponent(e,!1))throw new Error('Brackets: Component "'+e+'" is already defined.');return t._type="component",components.register[e]=t,Brackets}function getComponent(e,t){if(e in components.register)return createRenderingInstanceObject(cloneObject(components.register[e]));if(!1!==t)throw new Error('Brackets: Component "'+e+'" not found.');return null}function getComponents(){return components}var templatesCache={};function renderToString(e){e._setStatus(renderingInstancesStatuses.processing),"function"==typeof e.beforeRender&&e.beforeRender.call(e);var t,n=e.cacheKey,r="string"==typeof n,a=e.data,i={parentInstance:e.instanceId,components:getComponents(),getFilter:getFilter,renderedComponents:[]},s=e.template,o=[i];r&&n in templatesCache?t=templatesCache[n]:(templateLiteralsEnabled||(s=(s=s.replace(/(?:\r\n|\r|\n)/g," ")).replace(/'/g,"'")),t=compileTemplate(tokenizeTemplate(s),["_runtime"].concat(Object.keys(a))),!r||n in templatesCache||(templatesCache[n]=t));each(a,function(e,t){o.push(t)});var c=t.apply(null,o);if("component"===e._type){c=c.replace(new RegExp(eventHandlersAttributeName+"=","g"),eventHandlersAttributeName+"-"+e._hash+"=");var l=(new DOMParser).parseFromString(c,"text/html").querySelector("body *");l&&(l.setAttribute(selectorAttributeName,e.instanceId),c=l.outerHTML)}return e._setStatus(renderingInstancesStatuses.rendered),{templateString:c,templateRuntime:i}}function bindEventHandlers(c){var e=document.querySelector(c.el);if(e){var t="component"===c._type?"-"+c._hash:"",r=eventHandlersAttributeName+t,n="["+r+"]",a=[];each(e.querySelectorAll(n),function(e,t){a.push(t)}),e.getAttribute(r)&&a.push(e),each(a,function(e,n){each(n.getAttribute(r).split(";"),function(e,t){!function(e,t){var n,r=(t=t.trim()).match(/^(\S+)/)[1],a=[];if((t=t.replace(r+" ","")).match(/\S+\(.*\)$/)){var i=t.match(/^([^(]+)\((.*)\)/),s=i[1],o=i[2];if(!c.methods||!c.methods[s])throw new Error('Brackets: Method "'+s+'" is not defined.');n=c.methods[s],a=[o]}else n=new Function("data","this."+t+"; return this;");e.addEventListener(r,function(e){n.apply(c.data,[e].concat(a))})}(n,t)}),Brackets.devMode||n.removeAttribute(r)})}}function redrawInstance(e){var t=getRenderingInstance(e),r=document.querySelector(t.el);t.beforeRender.call(t,r);var n=renderToString(t),a=(new DOMParser).parseFromString(n.templateString,"text/html").querySelector(t.el);a&&(n.templateString=a.innerHTML),r.innerHTML=n.templateString,each(n.templateRuntime.renderedComponents,function(e,t){var n=getRenderingInstance(t);bindEventHandlers(n),"function"==typeof n.afterRender&&n.afterRender.call(n,r)}),bindEventHandlers(t),r.removeAttribute(nonInitializedElementAttributeName),t.afterRender.call(t,r)}function render(n){var e;if("string"==typeof n.el)e=document.querySelectorAll(n.el);else if(n.el instanceof Element)e=[n.el];else{if(!(n.el instanceof NodeList||Array.isArray(n.el)))throw new Error("Brackets: unsupported type for parameter el.");e=n.el}if(e)return each(e,function(e,t){redrawInstance(createRenderingInstanceObject(n,t).instanceId)}),Brackets}Brackets.templateLiteral=templateLiteral,Brackets.addFilter=addFilter,Brackets.getFilter=getFilter,Brackets.getFilters=getFilters,Brackets.addComponent=addComponent,Brackets.getComponents=getComponents,Brackets.addMacro=addMacro,Brackets.getMacros=getMacros,Brackets.getRenderingInstance=getRenderingInstance,Brackets.getRenderingInstances=getRenderingInstances,Brackets.render=render,Brackets.renderToString=function(e){return renderToString(createRenderingInstanceObject(e))},"undefined"!=typeof window&&void 0===window.Brackets?window.Brackets=Brackets:"object"==typeof module&&"object"==typeof module.exports&&(module.exports=Brackets)});
