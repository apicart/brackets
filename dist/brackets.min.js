/** 
 * brackets.js v1.0.0-alpha2 
 * (c) 2018-2019 Vladimír Macháček
 *  Released under the MIT License.
 */
!function(e){"function"==typeof define&&define.amd?define(e):e()}(function(){"use strict";var utils={cloneObject:function(t){var n={};return Object.keys(t).forEach(function(e){n[e]=t&&typeof t===Object(t)?utils.cloneObject(t[e]):t[e]}),n},mergeObjects:function(){var n={},e=Array.prototype.slice.call(arguments);return utils.each(e,function(e,t){utils.each(t,function(e,t){n[e]=e in n&&utils.isObject(t)?utils.mergeObjects(n[e],t):t})}),n},isObject:function(e){return null!=e&&!Array.isArray(e)&&"object"==typeof e},isFunction:function(e){return"function"==typeof e},each:function(e,t){var n,r,i,a,c,s={iterableLength:0,counter:0,isEven:function(){return this.counter%2==0},isOdd:function(){return 1===Math.abs(this.counter%2)},isFirst:function(){return 1===this.counter},isLast:function(){return this.counter===this.iterableLength}};if(!(-1<["undefined","number"].indexOf(typeof e)||null===e))if(Array.isArray(e)){if(!(r=Object.keys(e).length))return;for(s.iterableLength=r,n=0;n<r&&(s.counter++,!1!==t.apply(s,[n,e[n]]));n++);}else{if(a=(i=Object.keys(e)).length,!i.length)return;for(s.iterableLength=a,n=0;n<a&&(s.counter++,c=i[n],!1!==t.apply(s,[c,e[c]]));n++);}},generateHash:function(e){return e=e||10,e+=2,Math.random().toString(36).substring(2,e)}},macros={break:"break;",breakIf:"if (#0) break;",continue:"continue;",continueIf:"if (#0) continue;",component:function(e){var t=e[0].split(","),n=t[0];return t.shift(),"_template += _runtime.renderComponent('"+n+"', "+("{"+t.join(",")+"}")+");"},dump:"console.log(#0);",else:"} else {",elseif:"} else if (#0) {",for:"for (var #0) {","/for":"}",foreach:function(e){var t=(e=e[0].split("as"))[1].trim();return 1===e[1].split(",").length&&(t="key, "+t),"_runtime.utils.each("+e[0].trim()+", function ("+t+") {"},"/foreach":"});",if:"if (#0) {","/if":"}",js:"#0;",returnFalseIf:"if (#0) return false;",returnIf:"if (#0) return;",var:"var #0;",while:"while (#0) {","/while":"}"},openingDelimiter,closingDelimiter,macrosRegularExpression,openingDelimiter$1,closingDelimiter$1,tokenReplacement,textRegularExpression;function addMacro(e,t){if(e in macros)throw new Error('Brackets: Macro "'+e+'" is already defined.');return macros[e]=t,generateMacrosRegularExpression(),Brackets}function getMacros(){return macros}function generateMacrosRegularExpression(){macrosRegularExpression=new RegExp(openingDelimiter+" *(?:(?:("+Object.keys(macros).join("|").replace("/","/")+")(?: (.*?))?) *| *(?:(\\$.*?))) *"+closingDelimiter)}function initMacros(e){openingDelimiter=e.delimiters[0],closingDelimiter=e.delimiters[1],generateMacrosRegularExpression()}function tokenizeTemplate(e){var t,n,r,i=[],a=[];if(e){for(;t=macrosRegularExpression.exec(e);)n=[],r=t[0],t.shift(),utils.each(t,function(e,t){isNaN(parseInt(e))||void 0!==t&&n.push(t)}),i.push(n),e=e.replace(r,tokenReplacement);for(e=openingDelimiter$1+e+closingDelimiter$1;t=textRegularExpression.exec(e);)a.push(t[1]),e=e.replace(t[0],"")}return{macros:i,text:a}}function initTemplateTokenizer(e){openingDelimiter$1=e.delimiters[0],closingDelimiter$1=e.delimiters[1],textRegularExpression=new RegExp(openingDelimiter$1+"((?:.|\n)*?)"+closingDelimiter$1),tokenReplacement=closingDelimiter$1+openingDelimiter$1}var Brackets={config:{devMode:!1,delimiters:["{{","}}"]},configure:function(e){return e&&(this.config=utils.mergeObjects(this.config,e)),initTemplateTokenizer(this.config),initMacros(this.config),this}},eventHandlersAttributeName="b-on",nonInitializedElementAttributeName="b-init",selectorAttributeName="b-instance",templateLiteralsEnabled=function(){try{return eval("`x`"),!0}catch(e){return!1}}(),templateLiteral=templateLiteralsEnabled?"`":"'";function bindPropertyDescriptors(n){utils.each(n._data,function(t,e){t in n.data||Object.defineProperty(n.data,t,{get:function(){return n._data[t]},set:function(e){n._data[t]=e,n.redraw()}})})}function bindEventHandlers(l){if(l.el){var r=eventHandlersAttributeName+"-"+l.hash,e="["+r+"]",n=[];utils.each(l.el.querySelectorAll(e),function(e,t){n.push(t)}),l.el.getAttribute(r)&&n.push(l.el),utils.each(n,function(e,n){var t=n.getAttribute(r).split(";");utils.each(t,function(e,t){!function(e,t){var n=(t=t.trim()).match(/^(\S+)/);if(n&&void 0!==n[1]){var r,i=n[1],a=[];if((t=t.replace(i+" ","")).match(/\S+\(.*\)$/)){var c=t.match(/^([^(]+)\((.*)\)/),s=c[1],o=c[2];if(!l.methods[s])throw new Error('Brackets: Method "'+s+'" is not defined.');r=l.methods[s],a=[o]}else r=new Function("data","this."+t+"; return this;");e.addEventListener(i,function(e){r.apply(l,[e].concat(a))})}}(n,t)}),Brackets.config.devMode||n.removeAttribute(r)})}}function processVariable(e){var n,r,i=!0,a=[],t=e[0].split("|"),c=t[0].replace("$","");return t.shift(),t.length&&utils.each(t,function(e,t){n=t.split(":"),"noescape"!==(r=n[0]||null)?((a="string"==typeof n[1]?n[1].split(","):[]).unshift(c),c="_templateAdd(["+a+"], '"+r+"')"):i=!1}),i&&(c="_templateAdd("+c+")"),"_template += "+c+";"}function processMacro(e){var n,t=e[0],r=getMacros();return e.shift(),"string"==typeof r[t]?(n=r[t],utils.each(e,function(e,t){n=n.replace(new RegExp("#"+e),t)})):n=r[t](e),n}var variableMatchRegularExpression=/^\$/;function compileTemplate(n,e){var r,i,a="var _template = '';"+_templateAdd.toString()+";";return utils.each(n.text,function(e,t){if(a+="_template += _templateAdd("+templateLiteral+t+templateLiteral+");",e in n.macros)if(r=n.macros[e],(i=r[0]).match(variableMatchRegularExpression))a+=processVariable(r);else{if(!(i in getMacros()))throw'Unknown token: "'+i+'"';a+=processMacro(r)}}),a+="return _template;",new Function(e.join(","),a)}function _templateAdd(e,t){return _runtime.templateAdd(e,t)}var filters={};function addFilter(e,t){if(getFilter(e,!1))throw new Error('Brackets: Filter "'+e+'" is already defined.');return filters[e]=t,Brackets}function getFilter(e,t){if(!1!==t&&!(e in filters))throw new Error('Brackets: Filter "'+e+'" not found.');return filters[e]||null}function getFilters(){return filters}addFilter("escape",function(e){var t={'"':"&quot;","&":"&amp;","'":"&#39;","/":"&#x2F;","<":"&lt;","=":"&#x3D;",">":"&gt;","`":"&#x60;"};return String(e).replace(/[&<>"'`=/]/g,function(e){return t[e]})});var components={register:{}};function addComponent(e,t){if(getComponent(e,!1))throw new Error('Brackets: Component "'+e+'" is already defined.');return t.type="component",components.register[e]=t,Brackets}function getComponent(e,t){if(e in components.register)return createRenderingInstanceObject(utils.cloneObject(components.register[e]));if(!1!==t)throw new Error('Brackets: Component "'+e+'" not found.');return null}function getComponents(){return components}var cacheManager={cache:{},getCache:function(e,t){return cacheManager.hasCache(e,t)?cacheManager.cache[e][t]:null},setCache:function(e,t,n){return cacheManager.hasCacheRegion(e)||(cacheManager.cache[e]={}),cacheManager.hasCache(e,t)||(cacheManager.cache[e][t]=n),cacheManager},hasCacheRegion:function(e){return e in cacheManager.cache},hasCache:function(e,t){return!!cacheManager.hasCacheRegion(e)&&t in cacheManager.cache[e]}},TEMPLATE_FUNCTIONS_CACHE_REGION="templateFunctions",TEMPLATE_RESULTS_CACHE_REGION="templateResults";function renderToString(e){var t=e.resultCacheEnabled?cacheManager.getCache(TEMPLATE_RESULTS_CACHE_REGION,e.hash):null;return t||(t=generateTemplateString(e)),t}function generateTemplateString(e){var t="string"==typeof e.cacheKey,n=t?cacheManager.getCache(TEMPLATE_FUNCTIONS_CACHE_REGION,e.cacheKey):null,r=e._data,i={renderComponent:function(e,t){return getComponent(e).render(this,t)},getFilter:getFilter,renderedComponents:[],utils:utils,templateAdd:function(e,t){return void 0===e?"":(Array.isArray(e)||(e=[e]),(t=!0===(t=!1===t?null:t)?"escape":t)?this.getFilter(t).apply(null,e):e)},parentInstance:e},a=e.template,c=[i];n||(templateLiteralsEnabled||(a=(a=a.replace(/(?:\r\n|\r|\n)/g," ")).replace(/'/g,"'")),n=compileTemplate(tokenizeTemplate(a),["_runtime"].concat(Object.keys(r))),t&&cacheManager.setCache(TEMPLATE_FUNCTIONS_CACHE_REGION,e.cacheKey,n));utils.each(r,function(e,t){c.push(t)});var s=n.apply(null,c);if(s=s.replace(new RegExp(eventHandlersAttributeName+"=","g"),eventHandlersAttributeName+"-"+e.hash+"="),"component"===e.type){var o=(new DOMParser).parseFromString(s,"text/html").querySelector("body *");o&&(o.setAttribute(selectorAttributeName,e.instanceId),s=o.outerHTML)}return e.resultCacheEnabled&&cacheManager.setCache(TEMPLATE_RESULTS_CACHE_REGION,e.hash,{templateString:s,templateRuntime:i}),{templateString:s,templateRuntime:i}}function renderInstance(e){if(e.redrawingEnabled&&e.el){e.destroyChildrenInstances();var t=renderToString(e),n=(new DOMParser).parseFromString(t.templateString,"text/html").body.firstChild,r=e.el;e.childrenInstancesIds=t.templateRuntime.renderedComponents,e.el=n,e.mount(),r.parentElement.replaceChild(n,r)}}function renderComponent(e,n,t){t&&utils.each(t,function(e,t){n.addData(e,t)}),n.parentInstanceId=e.parentInstance.instanceId;var r=renderToString(n);return n.childrenInstancesIds=r.templateRuntime.renderedComponents,e.renderedComponents=e.renderedComponents.concat([n.instanceId]),r.templateString}var renderingInstances={};function getRenderingInstances(n){if(!n)return renderingInstances;var r={};return utils.each(renderingInstances,function(e,t){t.type===n&&(r[e]=t)}),r}function getRenderingInstance(e,t){if(null===e)return null;if(!1!==t&&!(e in renderingInstances))throw new Error('Brackets: Rendering instance "'+e+'" not found.');return renderingInstances[e]||null}function createRenderingInstanceObject(e,t){"function"==typeof(e=utils.cloneObject(e)).template&&(e.template=e.template.call(e));var n={childrenInstancesIds:[],cacheKey:e.cacheKey||null,data:{},hash:utils.generateHash(),methods:{},parentInstanceId:null,redrawingEnabled:!0,resultCacheEnabled:e.resultCacheEnabled||!1,type:e.type||"view",template:e.template,addData:function(e,t){return this._data[e]=t,bindPropertyDescriptors(this),this},redraw:function(){return renderInstance(this),this},created:function(){return utils.isFunction(e.created)&&e.created(),this},mounted:function(){return utils.isFunction(e.mounted)&&e.mounted(),this},updated:function(){return utils.isFunction(e.updated)&&e.updated(),this},destroyed:function(){return utils.isFunction(e.destroyed)&&e.destroyed(),this},destroy:function(){return delete renderingInstances[this.instanceId],this.destroyed(),this},destroyChildrenInstances:function(){return destroyChildrenInstances(this),this},mount:function(){return mountInstance(this),this.mounted(),this},set instanceId(e){this._instanceId=e},get instanceId(){return this._instanceId?this._instanceId+"-"+this.hash:this.hash},get parentInstance(){return getRenderingInstance(this.parentInstanceId)},_data:e.data?utils.cloneObject(e.data):{},_instanceId:null};if(n.instanceId=e.instanceId||null,n.elSelector="["+selectorAttributeName+'="'+n.instanceId+'"]',n.type,n.el=t||null,"view"===n.type?n.render=function(){renderInstance(this)}:n.render=function(e,t){return renderComponent(e,this,t)},t&&!t.getAttribute(selectorAttributeName)&&t.setAttribute(selectorAttributeName,n.instanceId),!e.template&&t)n.template=t.outerHTML;else if(e.template&&e.template.match(/^#\S+/)){var r=document.querySelector(e.template);r&&(n.template=r.outerHTML)}else if(!e.template&&!t)throw new Error("Brackets: No template or target element provided for rendering.");if(utils.each(e.methods||{},function(e,t){n.methods[e]=t}),bindPropertyDescriptors(n),getRenderingInstance(n.instanceId,!1))throw new Error('Brackets: Rendering instance "'+n.instanceId+'" is already defined.');return(renderingInstances[n.instanceId]=n).created(),n}function destroyChildrenInstances(e){utils.each(e.childrenInstancesIds,function(e,t){var n=getRenderingInstance(t,!1);n&&n.destroy()}),e.childrenInstancesIds=[]}function mountInstance(r){bindEventHandlers(r),Brackets.config.devMode||(r.el.removeAttribute(nonInitializedElementAttributeName),r.el.removeAttribute("b-instance")),utils.each(r.childrenInstancesIds,function(e,t){var n=getRenderingInstance(t);n.el=r.el.querySelector('[b-instance="'+t+'"]'),n.mount()})}function render(n){var e;if("string"==typeof n.el)e=document.querySelectorAll(n.el);else if(n.el instanceof Element)e=[n.el];else{if(!(n.el instanceof NodeList||Array.isArray(n.el)))throw new Error("Brackets: unsupported type for parameter el.");e=n.el}if(1<e.length&&n.cacheKey&&!n.template)throw new Error("Brackets: you must provide a single template for '"+n.cacheKey+"' cacheKey because multiple target elements were found.");if(e)return utils.each(e,function(e,t){createRenderingInstanceObject(n,t).render()}),Brackets}Brackets.utils=utils,Brackets.cacheManager=cacheManager,Brackets.templateLiteral=templateLiteral,Brackets.addFilter=addFilter,Brackets.getFilter=getFilter,Brackets.getFilters=getFilters,Brackets.addComponent=addComponent,Brackets.getComponent=getComponent,Brackets.getComponents=getComponents,Brackets.addMacro=addMacro,Brackets.getMacros=getMacros,Brackets.getRenderingInstance=getRenderingInstance,Brackets.getRenderingInstances=getRenderingInstances,Brackets.render=render,Brackets.renderToString=function(e){return renderToString(createRenderingInstanceObject(e))},Brackets.configure(),"undefined"!=typeof window&&void 0===window.Brackets?window.Brackets=Brackets:"object"==typeof module&&"object"==typeof module.exports&&(module.exports=Brackets)});
